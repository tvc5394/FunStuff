from os import getcwd
from os.path import join
from time import sleep
from time import time
from selenium.webdriver import Chrome
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

#step 1 - Get to Instagram and login
url = "https://www.instagram.com/"
driver_path = join(getcwd(), 'chromedriver')
driver = Chrome(driver_path)
driver.get(url)

#make sure the page finishes loading
wait = WebDriverWait(driver, 15)
element = wait.until(EC.element_to_be_clickable((By.NAME, 'username')))
element = wait.until(EC.element_to_be_clickable((By.NAME, 'password')))

username = #type your username here
password = #type your password here

loc_username_box = driver.find_element_by_name('username')
loc_username_box.send_keys(username)

loc_password_box = driver.find_element_by_name('password')
loc_password_box.send_keys(password) 

sleep(3)

from selenium.webdriver.common.keys import Keys

loc_password_box.send_keys(Keys.ENTER) #like keyboard "enter"/"return"

#step 2 - Get to my profile page
element = wait.until(EC.element_to_be_clickable((By.CLASS_NAME, '_6q-tv')))
                                                 
loc_profile_pic = driver.find_element_by_css_selector('._6q-tv') #locate profile pic
loc_profile_pic.click()

element = wait.until(EC.element_to_be_clickable((By.CLASS_NAME, '-qQT3')))
                                                 
loc_profile_page = driver.find_element_by_css_selector('.-qQT3') #locate profile page tab
loc_profile_page.click()

#step 3 - Locate followers and get followers' names
element = wait.until(EC.element_to_be_clickable((By.XPATH, '//li[2]')))                                             
loc_followers = driver.find_element_by_xpath('//li[2]')
loc_followers.click()

element = wait.until(EC.element_to_be_clickable((By.CLASS_NAME, 'isgrP')))

popup_followers = driver.find_element_by_css_selector('.isgrP')

# Get scroll height
last_height = driver.execute_script("return arguments[0].scrollHeight", popup_followers)

while True:
    # Scroll down to bottom
    driver.execute_script("arguments[0].scrollTo(0, arguments[0].scrollHeight);", popup_followers)

    # Wait to load page
    sleep(2)

    # Calculate new scroll height and compare with last scroll height
    new_height = driver.execute_script("return arguments[0].scrollHeight", popup_followers)
    if new_height == last_height:
        break
    last_height = new_height
    
sleep(3)

list_followers = [e.text for e in driver.find_elements_by_xpath('//li')]
#print('followers:', list_followers)  

driver.find_elements_by_tag_name('svg')[-1].click() #exit the popup

#step 4 - Locate followings and get followings' names
element = wait.until(EC.element_to_be_clickable((By.XPATH, '//li[3]')))                                             
loc_following = driver.find_element_by_xpath('//li[3]')
loc_following.click()

element = wait.until(EC.element_to_be_clickable((By.CLASS_NAME, 'isgrP')))
                                                 
popup_following = driver.find_element_by_css_selector('.isgrP')

# Get scroll height
last_height = driver.execute_script("return arguments[0].scrollHeight", popup_following)

while True:
    # Scroll down to bottom
    driver.execute_script("arguments[0].scrollTo(0, arguments[0].scrollHeight);", popup_following)

    # Wait to load page
    sleep(2)

    # Calculate new scroll height and compare with last scroll height
    new_height = driver.execute_script("return arguments[0].scrollHeight", popup_following)
    if new_height == last_height:
        break
    last_height = new_height
    
sleep(3)

list_following = [e.text for e in driver.find_elements_by_xpath('//li')]
#print('following:', list_following)  

driver.find_elements_by_tag_name('svg')[-1].click() 

#step 5 - check the unfollowed ones and close Chrome
list_followers_modified = [s.split("\n", 1)[0] for s in list_followers] #prettify the names
list_following_modified = [s.split("\n", 1)[0] for s in list_following]

print(len(list(set(list_following_modified) - set(list_followers_modified))),
      'users did not follow back:', 
      list(set(list_following_modified) - set(list_followers_modified)))

driver.close()
